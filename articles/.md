---
title: "PR #93 lands: what 40 commits to a visual regression dashboard actually look like"
date: 
tags: ["visual-regression", "ci-cd", "playwright", "github-actions", "cv-builder"]
summary: "PR #93 merged after 40+ iterative commits, delivering a full visual regression dashboard with S3 storage, draw.io canvas navigation, and rich PR comments."
---

## What shipped

PR #93 merged. That's the short version. The longer version is 40+ commits over what looks like a multi-day grind through CI failures, security review comments, TypeScript errors, and five rounds of PR review before the branch was clean enough to land.

What the PR actually delivers:

- **`CanvasRunNavigator`** — replaces the placeholder `DiagramViewer` with a CI-aware thumbnail navigator. Each CI run gets its own slot on a draw.io canvas. You can browse runs, see baseline vs actual side-by-side with RED/GREEN frames, and navigate to the GitHub Pages viewer.
- **S3 screenshot storage** — Playwright screenshots are written to a volume-mounted path inside Docker, pushed to S3, and served via a static XML index. The Pages viewer reads that index.
- **Rich PR comments** — each visual regression run posts a comment table with screenshot thumbnails and a direct link to the GitHub Pages dashboard. The comment includes pass/fail per screenshot, not just a summary count.
- **`GET /api/tools` capability manifest** — a small addition that exposes what tools the backend supports. This matters for the ShellAgent work downstream.
- **TruffleHog false-trigger fix** — the secret scanner was firing on main push events when `BASE == HEAD`. Fixed by checking for that condition before running the scan.

Also: purefoy got the Claude Code GitHub App workflow added via PR #1. That's a small signal that we're starting to bring the supporting repos into the same CI posture as cv-builder.

## The decisions

The most instructive thing about this PR isn't what landed — it's the shape of the iteration.

Five review passes. Commits addressing individual review comment IDs (`3956651779`, `3956793655`, `3957024692`, etc.). That pattern tells you something: we're running Claude Code as a reviewer, getting structured feedback per comment, and addressing each one discretely. The commit messages are essentially a changelog of the review conversation.

This is the feedback loop we've been building toward. The reviewer isn't a rubber stamp — the fix for `3956417606` touched origin validation, `AbortController` cleanup, and error handling in one pass. That's real security review, not formatting nitpicks.

The S3-before-Pages ordering fix (`b28b21e`) is worth calling out specifically. The initial pipeline ran the Pages deployment before the S3 upload completed, so the viewer was pointing at a stale or empty XML index. The fix was sequencing, not logic — but it took a CI run to surface it. This is the kind of thing that only shows up in real infrastructure. Local development with mocked S3 would never catch it.

The switch from a custom SVG renderer to the S3 thumbnail navigator (`e4c64df`) was a scope decision. We had built a custom renderer, realized the maintenance surface was higher than necessary, and replaced it with a navigator that reads directly from S3's XML listing. Fewer moving parts, same visual output.

On the TypeScript front: the `TS2742` error on the Express `Router` type annotation (`c79286d`) and the Zod v4 `z.record` crash (`050d776`) are both symptoms of the same underlying issue — the dependency graph in this project is complex enough that version constraints interact in non-obvious ways. The pnpm lockfile mismatch commits (`8d2d3bf`, `5456760`) are evidence of that. We need the monorepo migration (#49) more than the open issue count suggests.

## Roadmap pulse

Roadmap phase 6 — visual regression CI as A/B testing foundation — is now materially further along. Issue #90 is closed. The baseline capture pipeline is solid: Playwright runs in Docker, writes to a volume path, screenshots go to S3, draw.io canvas updates on every CI run, PR comments show thumbnails.

What's not there yet: multi-run comparison and a visual diff timeline (issue #94). Right now each run overwrites the previous slot on the canvas. The next step is keeping run history so you can see a feature's visual state across multiple builds — that's the foundation for A/B variant testing.

Issue #89 (containerized LangGraph reviewer pipeline) is still open. The current Claude Code review integration is working, but it's not the full multi-agent PR audit we want. The rich review comment format we're already generating would map directly onto a structured audit report from that pipeline.

The Shell issues (#83, #84, #85, #86) are still open — common UI components, agent-graph components, application switcher, header shell. These are phase 1 work (extracting `@ojfbot/shell`) and haven't moved. The visual regression work consumed the sprint.

## What's next

Issue #94: add run-history persistence to the draw.io canvas so the navigator shows a timeline of builds, not just the latest. That's the concrete delta between "visual regression CI" and "A/B testing foundation" — you need the history to compare against.

---

*Generated by [daily-logger](https://github.com/ojfbot/daily-logger) — part of the ojfbot self-documenting development system.*
